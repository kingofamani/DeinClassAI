# 專案任務列表 (TODO)

## ✅ 已完成項目

- [x] **Docker & 部署基礎設定**:
    - [x] 編寫 `docker-compose.yaml`，用於本地開發環境的編排
    - [x] 配置 PostgreSQL 資料庫服務
    - [x] 設定 LiteLLM 服務與 PostgreSQL 整合
    - [x] 建立 `.gitignore` 檔案，保護敏感資訊

- [x] **LiteLLM 配置**:
    - [x] 編寫 `litellm_config/config.yaml`，配置模型列表和資料庫連線
    - [x] 編寫 `litellm_config/custom_callbacks.py`，實現時段控制邏輯
    - [x] 建立 `.env.litellm.example` 範本檔案
    - [x] 配置 LiteLLM UI 登入憑證

- [x] **環境變數管理**:
    - [x] 建立 `.env.example` 範本檔案
    - [x] 分離 LiteLLM 專用環境變數檔案 (`.env.litellm`)
    - [x] 解決 SSO 授權衝突問題

- [x] **Flask 應用開發**:
    - [x] 設置 `flask_app/` 目錄結構
    - [x] 創建 `requirements.txt`
    - [x] 完善 `app.py`，實現完整的後端 API 邏輯
        - [x] 統一的 LiteLLM API 請求函數
        - [x] 多層級權限套餐系統 (基礎班、進階班、專業班)
        - [x] 金鑰管理功能 (創建、列表、刪除、統計)
        - [x] 預算管理功能 (查詢、更新)
        - [x] 系統統計功能
        - [x] 完善的錯誤處理機制
    - [x] 完善 `templates/index.html`，打造現代化教師管理介面
        - [x] 響應式設計，支援桌面和行動裝置
        - [x] 即時系統統計儀表板
        - [x] 學生金鑰管理功能
        - [x] 預算監控和更新功能
        - [x] QR Code 生成和顯示
        - [x] 現代化 UI 設計

- [x] **學生輔助頁面**:
    - [x] 創建 `student_helper_page/setup.html`
    - [x] 完全重寫為現代化、響應式設計
        - [x] 自動偵測裝置類型
        - [x] 智慧型 API Base URL 設定
        - [x] 改進的金鑰複製功能 (支援多種瀏覽器)
        - [x] 清晰的步驟引導
        - [x] 鍵盤快捷鍵支援
        - [x] 錯誤處理和用戶回饋

- [x] **QR Code 功能實現**:
    - [x] 整合 QRCode.js 庫
    - [x] 自動生成包含學生資訊的 QR Code
    - [x] 響應式 QR Code 顯示
    - [x] 一鍵複製金鑰功能

## 🔄 進行中項目

- [ ] **預算管理介面**:
    - [x] 後端 API 實現 (預算查詢、更新)
    - [x] 前端預算監控介面
    - [x] 預算使用率視覺化
    - [ ] 預算警告和通知系統
    - [ ] 批量預算管理功能

- [ ] **時段控制管理**:
    - [x] LiteLLM 時段控制回調函數
    - [ ] 前端時段設定介面
    - [ ] 時段規則管理功能

## 📋 待完成項目

- [ ] **環境設定**: 
    - [ ] 獲取 OpenAI API 金鑰
    - [ ] 配置實際的環境變數值

- [ ] **Google Cloud 設定**: 
    - [ ] 創建 OAuth 2.0 憑證，用於 Open WebUI 的 Google 登入
    - [ ] 配置 OIDC 回調 URL

- [ ] **OpenWebUI API 學生管理系統** 🆕:
    - [ ] **用戶管理 API 整合**:
        - [ ] 實現 OpenWebUI 用戶註冊 API (`/api/v1/auths/signup`)
        - [ ] 實現用戶列表查詢 API (`/api/v1/users`)
        - [ ] 實現用戶資訊更新 API (`/api/v1/users/{user_id}`)
        - [ ] 實現用戶刪除 API (`/api/v1/users/{user_id}`)
        - [ ] 實現用戶密碼重設功能
        - [ ] 實現用戶狀態管理 (啟用/停用)
    
    - [ ] **學生名單管理介面**:
        - [ ] 創建學生名單頁面 (`/students`)
        - [ ] 學生列表顯示 (姓名、信箱、註冊時間、狀態)
        - [ ] 學生搜尋和篩選功能
        - [ ] 批量學生操作 (批量新增、刪除、狀態切換)
        - [ ] 學生資訊編輯功能
        - [ ] 學生使用統計顯示
    
    - [ ] **聊天記錄管理**:
        - [ ] 實現聊天記錄查詢 API (`/api/v1/chats`)
        - [ ] 按學生查看聊天記錄功能
        - [ ] 聊天記錄搜尋和篩選
        - [ ] 聊天記錄匯出功能 (JSON/PDF)
        - [ ] 敏感內容檢測和標記
        - [ ] 聊天記錄統計分析
    
    - [ ] **學生帳號自動化管理**:
        - [ ] 批量學生帳號創建功能
        - [ ] CSV 檔案批量匯入學生名單
        - [ ] 自動生成學生登入憑證
        - [ ] 學生帳號到期管理
        - [ ] 新學生歡迎郵件發送
        - [ ] 學生帳號狀態自動同步
    
    - [ ] **權限和群組管理**:
        - [ ] 實現 OpenWebUI 用戶群組管理
        - [ ] 學生權限等級設定 (基礎班/進階班/專業班)
        - [ ] 模型存取權限控制
        - [ ] 功能權限細粒度控制
        - [ ] 群組批量權限設定
    
    - [ ] **使用監控和分析**:
        - [ ] 學生使用情況儀表板
        - [ ] 模型使用統計 (按學生、按時間)
        - [ ] 對話頻率和時長分析
        - [ ] 學生活躍度追蹤
        - [ ] 異常使用行為檢測
        - [ ] 使用報告自動生成
    
    - [ ] **隱私和安全功能**:
        - [ ] 實現 `ENABLE_ADMIN_CHAT_ACCESS=false` 設定
        - [ ] 學生聊天記錄隱私保護
        - [ ] 管理員操作審計日誌
        - [ ] 敏感資料自動遮罩
        - [ ] 資料存取權限控制
    
    - [ ] **整合現有系統**:
        - [ ] 將 OpenWebUI 用戶與 LiteLLM 金鑰系統整合
        - [ ] 學生帳號與預算系統同步
        - [ ] 統一的學生身份驗證流程
        - [ ] 跨系統資料一致性維護

- [ ] **OpenWebUI API 進階功能** 🆕:
    - [ ] **RAG 文件管理**:
        - [ ] 實現文件上傳 API (`/api/v1/files/`)
        - [ ] 知識庫管理功能
        - [ ] 學生專屬文件空間
        - [ ] 文件分享和協作功能
    
    - [ ] **自訂模型管理**:
        - [ ] 教師自訂模型創建
        - [ ] 模型參數調整介面
        - [ ] 學生可用模型配置
        - [ ] 模型效能監控
    
    - [ ] **對話模板和預設**:
        - [ ] 創建課程專用對話模板
        - [ ] 學習提示詞管理
        - [ ] 常用問題預設回覆
        - [ ] 對話引導機制

- [ ] **生產環境部署**:
    - [ ] 在 Railway 或 VPS 上進行部署測試
    - [ ] 配置 HTTPS 憑證
    - [ ] 設定網域名稱和 DNS
    - [ ] 將 `setup.html` 託管到一個公開可訪問的靜態網站服務（如 GitHub Pages）

- [ ] **功能完善**:
    - [ ] 實現批量金鑰操作
    - [ ] 加入使用統計圖表
    - [ ] 實現金鑰有效期管理
    - [ ] 加入學生使用報告功能

- [ ] **測試**:
    - [ ] 端到端測試教師管理流程
    - [ ] 端到端測試學生使用流程
    - [ ] 驗證預算、模型、時段控制規則是否生效
    - [ ] OpenWebUI API 整合測試
    - [ ] 學生管理功能測試

- [ ] **文檔完善**:
    - [x] 更新 `README.md`，加入詳細的部署步驟和環境變數說明
    - [x] 建立快速開始指南 (`QUICK_START.md`)
    - [x] 建立啟動腳本 (`start.sh` 和 `start.ps1`)
    - [ ] 建立使用者手冊
    - [ ] 建立部署指南
    - [ ] OpenWebUI API 整合文檔

## 🚨 重要注意事項

1. **資料庫遷移**: 已從 SQLite 改為 PostgreSQL，需確保舊資料的遷移
2. **環境變數安全**: 確保 `.env.litellm` 檔案不被提交到版本控制
3. **LITELLM_SALT_KEY**: 一旦設定就不能更改，請妥善保管
4. **HTTPS 需求**: 手機客戶端需要 HTTPS 才能存取動作感應器 API
5. **權限套餐**: 新增了三層級權限套餐系統，可根據需求調整預算和模型存取權限
6. **OpenWebUI API 整合**: 需要確保 OpenWebUI 服務正常運行並設定 `ENV=dev` 以存取 Swagger 文檔
7. **學生隱私保護**: 建議啟用 `ENABLE_ADMIN_CHAT_ACCESS=false` 來保護學生對話隱私
8. **API 認證**: 所有 OpenWebUI API 調用都需要有效的 Bearer Token 認證